var ot=Object.create;var O=Object.defineProperty;var st=Object.getOwnPropertyDescriptor;var it=Object.getOwnPropertyNames;var ct=Object.getPrototypeOf,at=Object.prototype.hasOwnProperty;var ut=(t,e)=>{for(var r in e)O(t,r,{get:e[r],enumerable:!0})},R=(t,e,r,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let o of it(e))!at.call(t,o)&&o!==r&&O(t,o,{get:()=>e[o],enumerable:!(n=st(e,o))||n.enumerable});return t};var lt=(t,e,r)=>(r=t!=null?ot(ct(t)):{},R(e||!t||!t.__esModule?O(r,"default",{value:t,enumerable:!0}):r,t)),pt=t=>R(O({},"__esModule",{value:!0}),t);var Tt={};ut(Tt,{extract:()=>rt,extractFromJson:()=>tt,extractFromXml:()=>et,read:()=>kt});module.exports=pt(Tt);var j=(t="")=>{try{let e=new URL(t);return e!==null&&e.protocol.startsWith("http")}catch{return!1}},I=(t="",e="")=>{try{return new URL(e,t).toString()}catch{return""}},mt=["CNDID","__twitter_impression","_hsenc","_openstat","action_object_map","action_ref_map","action_type_map","amp","fb_action_ids","fb_action_types","fb_ref","fb_source","fbclid","ga_campaign","ga_content","ga_medium","ga_place","ga_source","ga_term","gs_l","hmb_campaign","hmb_medium","hmb_source","mbid","mc_cid","mc_eid","mkt_tok","referrer","spJobID","spMailingID","spReportId","spUserID","utm_brand","utm_campaign","utm_cid","utm_content","utm_int","utm_mailing","utm_medium","utm_name","utm_place","utm_pubreferrer","utm_reader","utm_social","utm_source","utm_swu","utm_term","utm_userid","utm_viz_id","wt_mc_o","yclid","WT.mc_id","WT.mc_ev","WT.srch","pk_source","pk_medium","pk_campaign"],k=t=>{try{let e=new URL(t);return mt.forEach(r=>{e.searchParams.delete(r)}),e.toString().replace(e.hash,"")}catch{return null}};var U=lt(require("cross-fetch"),1),C=require("fast-xml-parser"),dt=async(t,e={})=>{let{proxy:r={},signal:n=null}=e,{target:o,headers:s={}}=r;return await(0,U.default)(o+encodeURIComponent(t),{headers:s,signal:n})},ft=t=>{try{let e=t.split(`
`)[0].trim().replace("<?","<").replace("?>",">"),n=new C.XMLParser({ignoreAttributes:!1}).parse(e),{xml:o={}}=n;return o["@_encoding"]||"utf8"}catch{return"utf8"}},P=async(t,e={})=>{let{headers:r={"user-agent":"Mozilla/5.0 (X11; Linux x86_64; rv:109.0) Gecko/20100101 Firefox/115.0"},proxy:n=null,agent:o=null,signal:s=null}=e,i=n?await dt(t,{proxy:n,signal:s}):await(0,U.default)(t,{headers:r,agent:o,signal:s}),p=i.status;if(p>=400)throw new Error(`Request failed with error code ${p}`);let c=i.headers.get("content-type"),a=await i.arrayBuffer(),f=a?Buffer.from(a).toString().trim():"";if(/(\+|\/)(xml|html)/.test(c)){let d=c.split("charset="),u=d.length===2?d[1].trim():ft(f);return{type:"xml",text:new TextDecoder(u).decode(a).trim(),status:p,contentType:c}}if(/(\+|\/)json/.test(c))try{return{type:"json",json:JSON.parse(f),status:p,contentType:c}}catch{throw new Error("Failed to convert data to JSON object")}throw new Error(`Invalid content type: ${c}`)};var gt=t=>({}).toString.call(t);var x=t=>Array.isArray(t),E=t=>String(t)===t,M=t=>Number(t)===t;var w=t=>gt(t)==="[object Object]"&&!x(t);var g=(t,e)=>!t||!e?!1:Object.prototype.hasOwnProperty.call(t,e);var N=t=>{let e=M(t)?String(t):t;if(!E(e))throw new Error("InvalidInput: String required.");return e},z=(t,e=140)=>{let r=N(t);if(r.length<=e)return r;let o=r.substring(0,e).trim(),s=o.split(" ");return s.length>1?(s.pop(),s.map(p=>p.trim()).join(" ")+"..."):o.substring(0,e-3)+"..."},$=t=>N(t).replace(/(<([^>]+)>)/ig,"").trim();var Nt=globalThis.crypto;var A=require("fast-xml-parser"),J=(t={})=>g(t,"rss")&&g(t.rss,"channel"),V=(t={})=>g(t,"feed")&&g(t.feed,"entry"),X=(t={})=>g(t,"rdf:RDF")&&g(t["rdf:RDF"],"channel"),B=t=>!E(t)||!t.length?!1:A.XMLValidator.validate(t)===!0,W=(t="",e={})=>{let r={attributeNamePrefix:"@_",ignoreAttributes:!1,...e};return new A.XMLParser(r).parse(t)};var G=require("html-entities");var y=t=>{try{return t?new Date(t).toISOString():""}catch{return""}},S=(t,e=0)=>{let r=$(String(t).trim().replace(/^<!\[CDATA\[|\]\]>$/g,""));return(e>0?z(r,e):r).replace(/\n+/g," ")},l=t=>{let e=w(t)?t._text||t["#text"]||t._cdata||t.$t:t;return e?(0,G.decode)(String(e).trim()):""},L=(t=[],e="")=>{if(w(e)&&g(e,"@_isPermaLink")&&e["@_isPermaLink"]==="true")return l(e);let r=o=>{let s=o.map(i=>L(i));return s.length>0?s[0]:""},n=E(t)?l(t):w(t)&&g(t,"href")?l(t.href):w(t)&&g(t,"@_href")?l(t["@_href"]):w(t)&&g(t,"@_url")?l(t["@_url"]):w(t)&&g(t,"_attributes")?l(t._attributes.href):x(t)?r(t):"";return n||(j(e)?e:"")},b=(t,e="",r)=>{let n=L(t,e),o=k(n);return n?o||I(r,n):""},xt=t=>Math.abs(t.split("").reduce((e,r)=>Math.imul(31,e)+r.charCodeAt(0)|0,0)).toString(36),D=(t,e,r)=>t?l(t):xt(b(e))+"-"+new Date(r).getTime(),ht=t=>{let e=g(t,"@_url")?t["@_url"]:"",r=g(t,"@_type")?t["@_type"]:"",n=Number(g(t,"@_length")?t["@_length"]:0);return!e||!r?null:{url:e,type:r,length:n}},q=t=>w(t)?{text:l(t),domain:t["@_domain"]}:t,H=(t,e)=>e==="source"?{text:l(t),url:L(t)}:e==="category"?x(t)?t.map(q):q(t):e==="enclosure"?ht(t):t;var bt=(t,e)=>{let{useISODateFormat:r,descriptionMaxLen:n,baseUrl:o,getExtraEntryFields:s}=e,{id:i="",title:p="",url:c="",date_published:a="",summary:f="",content_html:d="",content_text:u=""}=t,h=r?y(a):a,_=s(t);return{...{id:D(i,c,a),title:p,link:b(c,"",o),published:h,description:S(u||d||f,n)},..._}},_t=(t,e)=>{let{normalization:r,baseUrl:n,getExtraFeedFields:o}=e;if(!r)return t;let{title:s="",home_page_url:i="",description:p="",language:c="",items:a=[]}=t,f=o(t),d=x(a)?a:[a];return{title:s,link:k(i)||I(n,i),description:p,language:c,published:"",generator:"",...f,entries:d.map(u=>bt(u,e))}},K=(t,e={})=>_t(t,e);var yt=(t,e)=>{let{useISODateFormat:r,descriptionMaxLen:n,baseUrl:o,getExtraEntryFields:s}=e,{guid:i="",title:p="",link:c="",pubDate:a="",description:f="","content:encoded":d=""}=t,u=r?y(a):a,h=l(f||d),_={id:D(i,c,a),title:l(p),link:b(c,i,o),published:u,description:S(h,n)},m=s(t);return{..._,...m}},wt=(t,e)=>{let{title:r="",link:n="",item:o}=t,i=(x(o)?o:[o]).map(c=>{let{id:a,title:f="",link:d=""}=c,u={...c,title:l(f),link:b(d,a,e)};return"guid description source".split(" ").forEach(m=>{g(c,m)&&(u[m]=l(c[m]))}),"source category enclosure author image".split(" ").forEach(m=>{g(u,m)&&(c[m]=H(u[m],m))}),u});return{...t,title:l(r),link:b(n,e),item:x(o)?i:i[0]}},St=(t,e={})=>{let{normalization:r,baseUrl:n,getExtraFeedFields:o}=e,s=t.rss.channel;if(!r)return wt(s,n);let{title:i="",link:p="",description:c="",generator:a="",language:f="",lastBuildDate:d="",item:u=[]}=s,h=o(s),_=x(u)?u:[u],m=e.useISODateFormat?y(d):d;return{title:l(i),link:b(p,"",n),description:c,language:f,generator:a,published:m,...h,entries:_.map(F=>yt(F,e))}},Q=(t,e={})=>St(t,e);var Dt=(t,e)=>{let{useISODateFormat:r,descriptionMaxLen:n,baseUrl:o,getExtraEntryFields:s}=e,{id:i="",title:p="",issued:c="",modified:a="",updated:f="",published:d="",link:u="",summary:h="",content:_=""}=t,m=f||a||d||c,F=l(h||_),T={id:D(i,u,m),title:l(p),link:b(u,i,o),published:r?y(m):m,description:S(F,n)},nt=s(t);return{...T,...nt}},Ft=(t,e)=>{let{id:r,title:n="",link:o="",entry:s}=t,p=(x(s)?s:[s]).map(a=>{let{id:f,title:d="",link:u="",summary:h="",content:_=""}=a,m={...a,title:l(d),link:b(u,f,e)};return g(m,"summary")&&(m.summary=l(h)),g(m,"content")&&(m.content=l(_)),m});return{...t,title:l(n),link:b(o,r,e),entry:x(s)?p:p[0]}},Et=(t,e={})=>{let{normalization:r,baseUrl:n,getExtraFeedFields:o}=e,s=t.feed;if(!r)return Ft(s,n);let{id:i="",title:p="",link:c="",subtitle:a="",generator:f="",language:d="",updated:u="",entry:h=[]}=s,_=o(s),m=x(h)?h:[h],F=e.useISODateFormat?y(u):u;return{title:l(p),link:b(c,i,n),description:a,language:d,generator:f,published:F,..._,entries:m.map(T=>Dt(T,e))}},Y=(t,e={})=>Et(t,e);var Ot=(t,e)=>{let{useISODateFormat:r,descriptionMaxLen:n,baseUrl:o,getExtraEntryFields:s}=e,{guid:i="",title:p="",link:c="","dc:date":a="",description:f="","content:encoded":d=""}=t,u=r?y(a):a,h=l(f||d),_={id:D(i,c,a),title:l(p),link:b(c,i,o),published:u,description:S(h,n)},m=s(t);return{..._,...m}},jt=(t,e)=>{let{title:r="",link:n="",item:o}=t,i=(x(o)?o:[o]).map(c=>{let{id:a,title:f="",link:d=""}=c;return{...c,title:l(f),link:b(d,a,e)}});return{...t,title:l(r),link:b(n,e),item:x(o)?i:i[0]}},It=(t,e={})=>{let{normalization:r,baseUrl:n,getExtraFeedFields:o}=e,s=t["rdf:RDF"];if(!r)return jt(s,n);let{title:i="",link:p="",description:c="",generator:a="","dc:language":f="","dc:date":d=""}=s.channel,{item:u}=s,h=o(s),_=x(u)?u:[u],m=e.useISODateFormat?y(d):d;return{title:l(i),link:b(p,"",n),description:c,language:f,generator:a,published:m,...h,entries:_.map(F=>Ot(F,e))}},Z=(t,e={})=>It(t,e);var v=(t={})=>{let{normalization:e=!0,descriptionMaxLen:r=250,useISODateFormat:n=!0,xmlParserOptions:o={},baseUrl:s="",getExtraFeedFields:i=()=>({}),getExtraEntryFields:p=()=>({})}=t;return{normalization:e,descriptionMaxLen:r,useISODateFormat:n,xmlParserOptions:o,baseUrl:s,getExtraFeedFields:i,getExtraEntryFields:p}},tt=(t,e={})=>K(t,v(e)),et=(t,e={})=>{if(!B(t))throw new Error("The XML document is not well-formed");let r=v(e),n=W(t,r.xmlParserOptions);return J(n)?Q(n,r):V(n)?Y(n,r):X(n)?Z(n,r):null},rt=async(t,e={},r={})=>{if(!j(t))throw new Error("Input param must be a valid URL");let n=await P(t,r);if(!n.text&&!n.json)throw new Error(`Failed to load content from "${t}"`);let{type:o,json:s,text:i}=n;return o==="json"?tt(s,e):et(i,e)},kt=async(t,e,r)=>(console.warn("WARNING: read() is deprecated. Please use extract() instead!"),rt(t,e,r));function At(){var r,n;if(((r=process.env.FEED_EXTRACTOR_CJS_IGNORE_WARNING)==null?void 0:r.toLowerCase())==="true")return;let t=o=>`\x1B[33m${o}\x1B[39m`;(((n=process.env.FEED_EXTRACTOR_CJS_TRACE_WARNING)==null?void 0:n.toLowerCase())==="true"?console.trace:console.warn)(t("The CJS build of @extractus/feed-extractor is deprecated. See https://github.com/extractus/feed-extractor#cjs-deprecated for details."))}At();0&&(module.exports={extract,extractFromJson,extractFromXml,read});
//# sourceMappingURL=bundle.cjs.map
